---
import type { MarkdownHeading } from "astro";
import { getAllPostsWithShortLinks } from "@/lib/blog";
import { formatWordCount } from "@/lib/readingMetrics";
import SidebarPanel from "./SidebarPanel";

export interface Props {
  author: string;
  twitterHandle: string;
  githubUrl: string;
  telegramUrl: string;
  headings?: MarkdownHeading[];
  channelUrl: string;
  qqGroupNumber: string;
  emailAddress: string;
}

const {
  headings,
  author,
  twitterHandle,
  githubUrl,
  telegramUrl,
  channelUrl,
  qqGroupNumber,
  emailAddress,
} = Astro.props;

const publishedPosts = await getAllPostsWithShortLinks(Astro.site!);
const totalWords = publishedPosts.reduce(
  (acc, post) => acc + post.readingStats.words,
  0,
);

const stats = {
  articles: publishedPosts.length,
  words: formatWordCount(totalWords),
};

const contacts = {
  qqGroup: qqGroupNumber,
  email: emailAddress,
};
---

<SidebarPanel
  client:load
  headings={headings}
  author={author}
  twitterHandle={twitterHandle}
  githubUrl={githubUrl}
  telegramUrl={telegramUrl}
  channelUrl={channelUrl}
  stats={stats}
  contacts={contacts}
/>