---
// src/pages/random.astro
import { type CollectionEntry, getCollection } from "astro:content";

const allPosts = await getCollection(
  "blog",
  ({ data }: CollectionEntry<"blog">) => data.draft !== true,
);
if (allPosts.length === 0) return Astro.redirect("/");

return Astro.redirect(
  encodeURI(
    `/blog/${allPosts[Math.floor(Math.random() * allPosts.length)].slug}`,
  ),
  307,
);
---